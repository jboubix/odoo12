<?xml version="1.0" encoding="utf-8"?>
<odoo>
<data>
    <record id="view_account_invoice_payment_report_pivot" model="ir.ui.view">
         <field name="name">account.invoice.payment.report.pivot</field>
         <field name="model">account.invoice.payment.report</field>
         <field name="arch" type="xml">
             <pivot string="Invoice Payments Analysis" disable_linking="True">
                 <field name="color_id" type="row"/>
                 <field name="date" type="col"/>
                 <field name="prorated_payment_amount" type="measure"/>
             </pivot>
         </field>
    </record>

    <record id="view_account_invoice_payment_report_graph" model="ir.ui.view">
         <field name="name">account.invoice.payment.report.graph</field>
         <field name="model">account.invoice.payment.report</field>
         <field name="arch" type="xml">
             <graph string="Invoice Payments Analysis">
                 <field name="color_id"/>
                 <field name="prorated_payment_amount" type="measure"/>
             </graph>
         </field>
    </record>

    <record id="view_account_invoice_payment_report_tree" model="ir.ui.view">
         <field name="name">account.invoice.payment.report.tree</field>
         <field name="model">account.invoice.payment.report</field>
         <field name="arch" type="xml">
             <tree string="Invoice Payments Analysis">
                 <field name="id"/>
                 <field name="account_invoice_id"/>
                 <field name="account_invoice_number"/>
                 <field name="account_invoice_state"/>
                 <field name="account_invoice_type"/>
                 <field name="date_invoice"/>
                 <field name="commercial_partner_id"/>
                 <field name="account_invoice_amount_untaxed_usd"/>
                 <field name="user_id"/>
                 <field name="payment_currency_id"/>
                 <field name="payment_id"/>
                 <field name="date" string="Payment Date"/>
                 <field name="product_id"/>
                 <field name="dnk_price_subtotal_usd"/>
                 <field name="quantity"/>
                 <field name="prorated_payment_amount"/>
                 <field name="dnk_price_subtotal_usd"/>
                 <field name="color_id"/>
                 <field name="family_id"/>
                 <field name="subfamily_id"/>
                 <field name="company_id"/>
             </tree>
         </field>
    </record>

    <!-- Custom reports (aka filters) -->
    <record id="filter_invoice_payment_salespersons" model="ir.filters">
        <field name="name">By Salespersons</field>
        <field name="model_id">account.invoice.payment.report</field>
        <field name="domain">[]</field>
        <field name="user_id" eval="False"/>
        <field name="context">{'group_by': ['date:month', 'user_id']}</field>
    </record>
    <record id="filter_invoice_payment_product" model="ir.filters">
        <field name="name">By Product</field>
        <field name="model_id">account.invoice.payment.report</field>
        <field name="domain">[]</field>
        <field name="user_id" eval="False"/>
        <field name="context">{'group_by': ['date:month', 'product_id'], 'set_visible':True, 'residual_invisible':True}</field>
    </record>
    <record id="filter_invoice_payment_product_category" model="ir.filters">
        <field name="name">By Product Color</field>
        <field name="model_id">account.invoice.payment.report</field>
        <field name="domain">[]</field>
        <field name="user_id" eval="False"/>
        <field name="context">{'group_by': ['date:month', 'color_id'], 'residual_invisible':True}</field>
    </record>
    <record id="filter_invoice_payment_refund" model="ir.filters">
        <field name="name">By Credit Note</field>
        <field name="model_id">account.invoice.payment.report</field>
        <field name="domain">[('account_invoice_type', '=', 'out_refund')]</field>
        <field name="user_id" eval="False"/>
        <field name="context">{'group_by': ['date:month', 'user_id']}</field>
    </record>

    <record id="view_account_invoice_payment_report_search" model="ir.ui.view">
        <field name="name">account.invoice.payment.report.search</field>
        <field name="model">account.invoice.payment.report</field>
        <field name="arch" type="xml">
            <search string="Invoices Payment Analysis USD without Taxes">
                <filter string="My Invoice Payment" name="my_invoice" domain="[('user_id', '=', uid)]"/>
                <separator/>
                <field name="date"/>
                <filter string="This Year" name="thisyear" domain="['|', ('date', '=', False), '&amp;',('date','&lt;=', time.strftime('%%Y-12-31')),('date','&gt;=',time.strftime('%%Y-01-01'))]" help="Journal invoices with period in current year"/>
                <separator/>
                <filter string="This Month" name="this_month" domain="[('date', '&gt;=', context_today().strftime('%%Y-%%m-01'))]"/>
                <filter string="Last Month" name="last_month" domain="['&amp;', ('date', '&gt;=', (context_today() - relativedelta(months=1)).strftime('%%Y-%%m-01')), ('date', '&lt;', context_today().strftime('%%Y-%%m-01'))]"/>
                <separator/>
                <filter string="Customer" name="customer" domain="['|', ('account_invoice_type','=','out_invoice'),('account_invoice_type','=','out_refund')]"/>
                <filter string="Vendor" name="supplier" domain="['|', ('account_invoice_type','=','in_invoice'),('account_invoice_type','=','in_refund')]"/>
                <separator/>
                <filter string="Invoice" domain="['|', ('account_invoice_type','=','out_invoice'),('account_invoice_type','=','in_invoice')]"/>
                <filter string="Credit Note" domain="['|', ('account_invoice_type','=','out_refund'),('account_invoice_type','=','in_refund')]"/>
                <field name="commercial_partner_id" operator="child_of"/>
                <field name="user_id" />
                <field name="color_id" filter_domain="[('color_id', 'child_of', self)]"/>
                <field name="family_id" filter_domain="[('family_id', 'child_of', self)]"/>
                <field name="subfamily_id" filter_domain="[('subfamily_id', 'child_of', self)]"/>
                <field name="family_id"/>
                <field name="subfamily_id"/>
                <group expand="1" string="Group By">
                    <filter string="Partner" name="commercial_partner_id" context="{'group_by':'commercial_partner_id','residual_visible':True}"/>
                    <filter string="Salesperson" name='user' context="{'group_by':'user_id'}"/>
                    <filter string="Sales Channel" name='team' context="{'group_by':'team_id'}"/>
                    <filter string="Color" name="category_product" context="{'group_by':'color_id','residual_invisible':True}"/>
                    <filter string="Family" name='family' context="{'group_by':'family_id'}"/>
                    <filter string="Subfamily" name='subfamily' context="{'group_by':'subfamily_id'}"/>
                    <filter string="Status" context="{'group_by':'account_invoice_state'}"/>
                    <filter string="Company" context="{'group_by':'company_id'}" groups="base.group_multi_company"/>
                    <separator orientation="vertical" />
                    <filter string="Date" context="{'group_by':'date'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_account_invoice_payment_report_all_supp" model="ir.actions.act_window">
        <field name="name">Invoices Payment Analysis USD without Taxes</field>
        <field name="res_model">account.invoice.payment.report</field>
        <field name="view_type">form</field>
        <field name="view_mode">pivot,graph,tree</field>
        <field name="context">{'search_default_current':1, 'search_default_supplier':1, 'group_by':[], 'group_by_no_leaf':1, 'search_default_year': 1}</field>
        <field name="search_view_id" ref="view_account_invoice_payment_report_search"/>
        <field name="help">From this report, you can have an overview of the amount invoiced from your vendors. The search tool can also be used to personalise your Invoices reports and so, match this analysis to your needs.</field>
    </record>
    <record id="action_account_invoice_payment_report_all" model="ir.actions.act_window">
        <field name="name">Invoices Payment Analysis USD without Taxes</field>
        <field name="res_model">account.invoice.payment.report</field>
        <field name="view_type">form</field>
        <field name="view_mode">pivot,graph,tree</field>
        <field name="context">{'search_default_current':1, 'search_default_customer':1, 'group_by':[], 'group_by_no_leaf':1, 'search_default_year': 1}</field>
        <field name="search_view_id" ref="view_account_invoice_payment_report_search"/>
        <field name="help">From this report, you can have an overview of the amount invoiced to your customers. The search tool can also be used to personalise your Invoices reports and so, match this analysis to your needs.</field>
    </record>

    <menuitem name="Invoice Payments USD" action="action_account_invoice_payment_report_all" id="menu_action_account_invoice_payment_report_all" parent="account.account_reports_management_menu" sequence="20"/>
    <menuitem name="Invoice Payments USD" action="action_account_invoice_payment_report_all" id="menu_action_sale_invoice_payment_report_all" parent="sale.menu_sale_report" sequence="20"/>
    <menuitem name="Invoice Payments USD" action="action_account_invoice_payment_report_all" id="menu_action_crm_invoice_payment_report_all" parent="crm.crm_menu_report" sequence="20"/>

    <act_window
        id="act_account_invoice_payment_partner_relation"
        name="Monthly Turnover"
        groups="account.group_account_invoice"
        context="{'search_default_partner_id':[active_id], 'search_default_month':1,'search_default_user':1,'group_by_no_leaf':1,'group_by':[]}"
        res_model="account.invoice.payment.report"
        src_model="res.partner"
        view_mode="graph"/>

</data>
</odoo>
