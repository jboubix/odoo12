<?xml version="1.0"?>
<odoo>
    <data>
        <record id="dnk_mrp_production_sale_order_lines_form_view" model="ir.ui.view">
            <field name="name">dnk.mrp.production.sale.order.lines.form.view</field>
            <field name="model">mrp.production</field>
            <field name="inherit_id" ref="mrp.mrp_production_form_view"/>
            <!--<field name="groups_id" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>-->
            <field name="arch" type="xml">
                <xpath expr="//form/sheet/notebook/page[2]" position="after">
                  <page string="- Sale Information">
                      <field name="dnk_minimum_commitment_date"/>
                      <field name="dnk_sale_order_line_ids" nolabel="1" readonly="1">
                          <tree editable="bottom" create="0" delete="0">
                              <field name="order_id"/>
                              <field name="order_partner_id"/>
                              <field name="dnk_final_commitment_date"/>
                              <field name="product_uom_qty" sum="Total Sales Qty"/>
                              <field name="qty_delivered"/>
                              <field name="state"/>
                              <field name="salesman_id"/>
                              <!--<field name="team_id"/>-->
                          </tree>
                      </field>
                  </page>
                </xpath>
                <!--<field name="origin" position="attributes">
                    <attribute name="on_change">_compute_sale_order_by_origin()</attribute>
                </field>-->
            </field>
        </record>

        <record id="dnk_mrp_production_edit_sale_order_lines_form_view" model="ir.ui.view">
            <field name="name">dnk.mrp.production.edit.sale.order.lines.form.view</field>
            <field name="model">mrp.production</field>
            <field name="inherit_id" ref="dnk_mrp_production_sale_order_lines_form_view"/>
            <field name="groups_id" eval="[(4, ref('dnk_mrp_so_po_mo_link.dnk_mrp_sale_order_line_link'))]"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='dnk_sale_order_line_ids']" position="attributes">
                    <attribute name="readonly">False</attribute>
                </xpath>
            </field>
        </record>

        <!-- Agregar a la vista de lista en campo: dnk_sale_order_line_ids -->
        <record id="dnk_mrp_production_sale_order_lines_tree_view" model="ir.ui.view">
            <field name="name">dnk.mrp.production.sale.order.lines.tree.view</field>
            <field name="model">mrp.production</field>
            <field name="inherit_id" ref="mrp.mrp_production_tree_view"/>
            <!--<field name="groups_id" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>-->
            <field name="arch" type="xml">
                <field name="state" position="after">
                    <field name="dnk_sale_order_line_ids" widget="many2many_tags"/>
                    <field name="dnk_minimum_commitment_date"  options='{"bg_color": "red: dnk_minimum_commitment_date &lt; current_date", "fg_color": "white: dnk_minimum_commitment_date &lt; current_date"}'/>
                </field>
                <field name="origin" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <tree position="attributes">
                    <attribute name="decoration-bf">dnk_minimum_commitment_date&lt;current_date</attribute>
                </tree>
                <field name="date_planned_start" position="attributes">
                    <attribute name="options">{"bg_color": "orange: date_planned_start &gt; dnk_minimum_commitment_date", "fg_color": "white: date_planned_start &gt; dnk_minimum_commitment_date"}</attribute>
                </field>
            </field>
        </record>


        <record id="dnk_mrp_production_sale_order_lines_search_view" model="ir.ui.view">
            <field name="name">dnk.mrp.production.sale.order.lines.search.view</field>
            <field name="model">mrp.production</field>
            <field name="inherit_id" ref="mrp.view_mrp_production_filter"/>
            <field name="arch" type="xml">
                <filter name="waiting" position="after">
                    <separator/>
                    <filter string="+ Hoy + 1" name="A planear + 1" domain="[('date_planned_start','&lt;=',(context_today()+relativedelta(days=2)).strftime('%Y-%m-%d 23:59:59'))]"/>
                    <filter string="+ Hoy + 2" name="A planear + 2" domain="[('date_planned_start','&lt;=',(context_today()+relativedelta(days=3)).strftime('%Y-%m-%d 23:59:59'))]"/>
                    <filter string="+ Hoy + 5" name="A planear + 5" domain="[('date_planned_start','&lt;=',(context_today()+relativedelta(days=5)).strftime('%Y-%m-%d 23:59:59'))]"/>
                    <filter string="+ Atrasado" name="A planear - Atrasado" domain="[('date_planned_start','&lt;',(context_today()-relativedelta(days=1)).strftime('%Y-%m-%d 23:59:59'))]"/>
                    <filter string="+ Ayer y Hoy" name="Ayer y Hoy" domain="[('date_planned_start','&lt;=',(context_today()+relativedelta(days=0)).strftime('%Y-%m-%d 23:59:59')), ('date_planned_start','&gt;=',(context_today()-relativedelta(days=2)).strftime('%Y-%m-%d 23:59:59'))]"/>
                    <filter string="+ Semana Actual" domain="[('date_planned_start', '&gt;=', ((context_today()+relativedelta(weeks=-1,days=1, weekday=0)).strftime('%%Y-%%m-%%d'))),('date_planned_start', '&lt;=', ((context_today()+relativedelta(weeks=-0,weekday=6)).strftime('%%Y-%%m-%%d')))]"/>
                    <filter string="+ Semana Pasada" domain="[('date_planned_start', '&gt;=', ((context_today()+relativedelta(weeks=-2,days=1, weekday=0)).strftime('%%Y-%%m-%%d'))),('date_planned_start', '&lt;=', ((context_today()+relativedelta(weeks=-1,weekday=6)).strftime('%%Y-%%m-%%d')))]"/>
                    <separator/>
                </filter>
            </field>
        </record>
    </data>
</odoo>
